{
  "dashboard": {
    "id": null,
    "title": "FBPro.MCP Production Dashboard",
    "tags": ["fbpro", "production", "nodejs", "api"],
    "style": "dark",
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "HTTP Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m])) by (method, route)",
            "legendFormat": "{{method}} {{route}}"
          }
        ],
        "yAxes": [
          {
            "label": "Requests/sec",
            "min": 0
          }
        ],
        "alert": {
          "conditions": [
            {
              "query": {
                "params": ["A", "5m", "now"]
              },
              "reducer": {
                "type": "avg"
              },
              "evaluator": {
                "params": [100],
                "type": "gt"
              }
            }
          ],
          "executionErrorState": "alerting",
          "noDataState": "no_data",
          "frequency": "10s",
          "handler": 1,
          "name": "High Request Rate"
        }
      },
      {
        "id": 2,
        "title": "Response Time P95",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_ms_bucket[5m])) by (le, method, route))",
            "legendFormat": "P95 {{method}} {{route}}"
          }
        ],
        "yAxes": [
          {
            "label": "Milliseconds",
            "min": 0
          }
        ],
        "thresholds": [
          {
            "value": 800,
            "colorMode": "critical",
            "op": "gt"
          }
        ]
      },
      {
        "id": 3,
        "title": "Error Rate (5xx)",
        "type": "singlestat",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status_code=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m])) * 100"
          }
        ],
        "format": "percent",
        "thresholds": "1,5",
        "colorBackground": true
      },
      {
        "id": 4,
        "title": "AI Request Success Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(ai_requests_total{status=\"success\"}[5m])) by (provider)",
            "legendFormat": "{{provider}} Success"
          },
          {
            "expr": "sum(rate(ai_requests_total{status=\"error\"}[5m])) by (provider)",
            "legendFormat": "{{provider}} Error"
          }
        ],
        "yAxes": [
          {
            "label": "Requests/sec",
            "min": 0
          }
        ]
      },
      {
        "id": 5,
        "title": "Node.js Memory Usage",
        "type": "graph",
        "targets": [
          {
            "expr": "process_resident_memory_bytes / 1024 / 1024",
            "legendFormat": "RSS Memory (MB)"
          },
          {
            "expr": "nodejs_heap_size_used_bytes / 1024 / 1024",
            "legendFormat": "Heap Used (MB)"
          }
        ],
        "yAxes": [
          {
            "label": "Megabytes",
            "min": 0
          }
        ]
      },
      {
        "id": 6,
        "title": "CPU Usage",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(process_cpu_user_seconds_total[5m]) * 100",
            "legendFormat": "User CPU %"
          },
          {
            "expr": "rate(process_cpu_system_seconds_total[5m]) * 100",
            "legendFormat": "System CPU %"
          }
        ],
        "yAxes": [
          {
            "label": "CPU %",
            "min": 0,
            "max": 100
          }
        ]
      },
      {
        "id": 7,
        "title": "Database Connections",
        "type": "singlestat",
        "targets": [
          {
            "expr": "nodejs_active_handles_total"
          }
        ],
        "format": "short",
        "thresholds": "50,100"
      },
      {
        "id": 8,
        "title": "Event Loop Lag",
        "type": "graph",
        "targets": [
          {
            "expr": "nodejs_eventloop_lag_seconds * 1000",
            "legendFormat": "Event Loop Lag (ms)"
          }
        ],
        "yAxes": [
          {
            "label": "Milliseconds",
            "min": 0
          }
        ],
        "thresholds": [
          {
            "value": 10,
            "colorMode": "critical",
            "op": "gt"
          }
        ]
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "5s",
    "annotations": {
      "list": [
        {
          "name": "Deployments",
          "enable": true,
          "iconColor": "green",
          "tags": ["deployment"]
        }
      ]
    }
  }
}